<?class newsM extends model{			static function add($data){						if($img=image::get('img',true)){			if($img->imageType!='JPG'){				self::setMessage('Изображение должно быть jpg');				return false;			}		}else{			self::setMessage('Изображение отсутствует');			return false;		}				if(!$data['h1'] ){			self::setMessage('h1 должен быть заполнены');			return false;		}				if(!($flash=self::checkgame($data['game'])) && !$data['gametext'])return false;					$data=self::filt($data,array('h1','title','controls','text','category','gametext','gamewidth','gamevid','order'));				$data['url']=str::translit($data['h1']);		$tb= new table('news');		$id=$tb->insert($data);				if($id){			$img->name=$id.".jpg";			$img->moveTo('/uploads/news/');			$img->resize(160,120);						if($flash){				$flash->saveas('/uploads/news/'.$id.".swf");				if($flash->width && $flash->height){					$tb->update(array('gamewh'=>$flash->width/$flash->height,'hash'=>md5($flash->getContent())),$id);				}			}			}			return true;	}		static function change($data){			if(!$data['h1']){			self::setMessage('h1 должен быть заполнены');			return false;		}		if($data['game']){			if(!($flash=self::checkgame($data['game'])))return false;		}					$id=(int)$data['id'];		$data=self::filt($data,array('h1','title','controls','text','category','gametext','gamewidth','gamevid','order'));		$tb= new table('news');		$tb->update($data,$id);				if($img=image::get('img',true)){			if($img->imageType!='JPG'){				self::setMessage('Изображение должно быть jpg');				return false;			}			$img->name=$id.".jpg";			$img->moveTo('/uploads/news/');						$img->resize(160,120);		}						if($flash){			$flash->saveas('/uploads/news/'.$id.".swf");			if($flash->width && $flash->height){				$tb->update(array('gamewh'=>$flash->width/$flash->height,'hash'=>md5($flash->getContent())),$id);			}		}			return true;	}		static function checkgame($url){		if($flash=image::getByCurl($url)){				if($flash->type!="application/x-shockwave-flash"){					self::setMessage('Тип игры должен быть application/x-shockwave-flash');					return false;				}				if($flash->size<100 || !$flash->data){					self::setMessage('Ошибка загрузки игры');					return false;				}		}else{					self::setMessage('Ошибка загрузки игры');					return false;		}		return $flash; 	}		static function delete($id){		$tb=new table('news');		$tb->delete($id);		if($img=image::get('/uploads/news/'.$id.".jpg")){			$img->delete();		}		if($img=image::get('/uploads/news/'.$id.".swf")){			$img->delete();		}	}}?>